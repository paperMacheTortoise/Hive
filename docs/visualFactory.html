<!DOCTYPE html>

<html>
<head>
  <title>visualFactory.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="auth.html">
                  auth.js
                </a>
              
                
                <a class="source" href="directmessage.html">
                  directmessage.js
                </a>
              
                
                <a class="source" href="main.html">
                  main.js
                </a>
              
                
                <a class="source" href="oAuth.html">
                  oAuth.js
                </a>
              
                
                <a class="source" href="orgsignup.html">
                  orgsignup.js
                </a>
              
                
                <a class="source" href="profile.html">
                  profile.js
                </a>
              
                
                <a class="source" href="reply.html">
                  reply.js
                </a>
              
                
                <a class="source" href="room.html">
                  room.js
                </a>
              
                
                <a class="source" href="upload.html">
                  upload.js
                </a>
              
                
                <a class="source" href="visual.html">
                  visual.js
                </a>
              
                
                <a class="source" href="visualReply.html">
                  visualReply.js
                </a>
              
                
                <a class="source" href="authFactory.html">
                  authFactory.js
                </a>
              
                
                <a class="source" href="dmFactory.html">
                  dmFactory.js
                </a>
              
                
                <a class="source" href="oAuthFactory.html">
                  oAuthFactory.js
                </a>
              
                
                <a class="source" href="orgsignupFactory.html">
                  orgsignupFactory.js
                </a>
              
                
                <a class="source" href="replyFactory.html">
                  replyFactory.js
                </a>
              
                
                <a class="source" href="roomFactory.html">
                  roomFactory.js
                </a>
              
                
                <a class="source" href="uploadFactory.html">
                  uploadFactory.js
                </a>
              
                
                <a class="source" href="userFactory.html">
                  userFactory.js
                </a>
              
                
                <a class="source" href="visualFactory.html">
                  visualFactory.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>visualFactory.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>angular.module(<span class="hljs-string">'visualFactory'</span>, [<span class="hljs-string">'firebase'</span>])

.factory(<span class="hljs-string">'Visualization'</span>, [<span class="hljs-string">'$firebaseArray'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$firebaseArray</span>)</span>{
	
	<span class="hljs-keyword">var</span> visualFactory = {};
	<span class="hljs-keyword">var</span> ref = <span class="hljs-keyword">new</span> Firebase(<span class="hljs-string">'https://bizgramer.firebaseio.com/hr/visualizations'</span>);

	<span class="hljs-keyword">var</span> visualId = <span class="hljs-string">''</span>;
	visualFactory.setName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>)</span>{
		visualId = name;
	};

	visualFactory.getName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
		<span class="hljs-keyword">return</span> visualId;
	};

	visualFactory.getMessages = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>)</span>{
		<span class="hljs-keyword">var</span> messageRef = ref.child(name).child(<span class="hljs-string">'messages'</span>);
		messages = $firebaseArray(messageRef);
		<span class="hljs-keyword">return</span> messages;
	};

	visualFactory.addMessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">user, name, text</span>)</span>{
		<span class="hljs-keyword">var</span> messageRef = ref.child(name).child(<span class="hljs-string">'messages'</span>);
		messages = $firebaseArray(messageRef);
		messages.$add({
			username: user,
			text: text,
			createdAt: Firebase.ServerValue.TIMESTAMP
		});
	};

	visualFactory.customTooltip = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tooltipId, width</span>) </span>{
		
	  $(<span class="hljs-string">"body"</span>).append(<span class="hljs-string">"&lt;div class='tooltip' id='"</span>+tooltipId+<span class="hljs-string">"'&gt;&lt;/div&gt;"</span>);
	  
	  <span class="hljs-keyword">if</span>(width){
	    $(<span class="hljs-string">"#"</span>+tooltipId).css(<span class="hljs-string">"width"</span>, width);
	  }
	  
	  
	  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showTooltip</span>(<span class="hljs-params">content, event</span>)</span>{
	    $(<span class="hljs-string">"#"</span>+tooltipId).html(content);
	    $(<span class="hljs-string">"#"</span>+tooltipId).show();
	    
	    updatePosition(event);
	  }
	  
	  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideTooltip</span>(<span class="hljs-params"></span>)</span>{
	    $(<span class="hljs-string">"#"</span>+tooltipId).hide();
	  }
	  
	  hideTooltip();

	  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updatePosition</span>(<span class="hljs-params">event</span>)</span>{
	    <span class="hljs-keyword">var</span> ttid = <span class="hljs-string">"#"</span>+tooltipId;
	    <span class="hljs-keyword">var</span> xOffset = <span class="hljs-number">20</span>;
	    <span class="hljs-keyword">var</span> yOffset = <span class="hljs-number">10</span>;
	    
	     <span class="hljs-keyword">var</span> ttw = $(ttid).width();
	     <span class="hljs-keyword">var</span> tth = $(ttid).height();
	     <span class="hljs-keyword">var</span> wscrY = $(<span class="hljs-built_in">window</span>).scrollTop();
	     <span class="hljs-keyword">var</span> wscrX = $(<span class="hljs-built_in">window</span>).scrollLeft();
	     <span class="hljs-keyword">var</span> curX = (<span class="hljs-built_in">document</span>.all) ? event.clientX + wscrX : event.pageX;
	     <span class="hljs-keyword">var</span> curY = (<span class="hljs-built_in">document</span>.all) ? event.clientY + wscrY : event.pageY;
	     <span class="hljs-keyword">var</span> ttleft = ((curX - wscrX + xOffset*<span class="hljs-number">2</span> + ttw) &gt; $(<span class="hljs-built_in">window</span>).width()) ? curX - ttw - xOffset*<span class="hljs-number">2</span> : curX + xOffset;
	     <span class="hljs-keyword">if</span> (ttleft &lt; wscrX + xOffset){
	      ttleft = wscrX + xOffset;
	     } 
	     <span class="hljs-keyword">var</span> tttop = ((curY - wscrY + yOffset*<span class="hljs-number">2</span> + tth) &gt; $(<span class="hljs-built_in">window</span>).height()) ? curY - tth - yOffset*<span class="hljs-number">2</span> : curY + yOffset;
	     <span class="hljs-keyword">if</span> (tttop &lt; wscrY + yOffset){
	      tttop = curY + yOffset;
	     } 
	     $(ttid).css(<span class="hljs-string">'top'</span>, tttop + <span class="hljs-string">'px'</span>).css(<span class="hljs-string">'left'</span>, ttleft + <span class="hljs-string">'px'</span>);
	  }
	  
	  <span class="hljs-keyword">return</span> {
	    showTooltip: showTooltip,
	    hideTooltip: hideTooltip,
	    updatePosition: updatePosition
	  };
	};

	visualFactory.addCommas = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">nStr</span>)
	</span>{
	  nStr += <span class="hljs-string">''</span>;
	  x = nStr.split(<span class="hljs-string">'.'</span>);
	  x1 = x[<span class="hljs-number">0</span>];
	  x2 = x.length &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">'.'</span> + x[<span class="hljs-number">1</span>] : <span class="hljs-string">''</span>;
	  <span class="hljs-keyword">var</span> rgx = <span class="hljs-regexp">/(\d+)(\d{3})/</span>;
	  <span class="hljs-keyword">while</span> (rgx.test(x1)) {
	    x1 = x1.replace(rgx, <span class="hljs-string">'$1'</span> + <span class="hljs-string">','</span> + <span class="hljs-string">'$2'</span>);
	  }
	  <span class="hljs-keyword">return</span> x1 + x2;
	};
	
	<span class="hljs-keyword">return</span> visualFactory;
}]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
